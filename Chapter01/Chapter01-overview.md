
<div dir="rtl" align="right">

# فصل ۱. همزمانی: یک مرور کلی

همزمانی یکی از جنبه‌های کلیدی و زیربنایی توسعه نرم‌افزار مدرن است. تا سال‌ها دستیابی به همزمانی، هرچند ممکن، کاری دشوار و پرزحمت بود. نوشتن و اشکال‌یابی برنامه‌های همزمان، پیچیده و زمان‌بر بود؛ به همین علت، بسیاری از توسعه‌دهندگان ترجیح می‌دادند از همزمانی صرف‌نظر کرده و مسیر ساده‌تر را برگزینند. اما امروزه، به لطف وجود کتابخانه‌ها و قابلیت‌هایی که در چهارچوب‌های مدرن .NET گنجانده شده، پیاده‌سازی همزمانی بسیار ساده‌تر شده است.  
مایکروسافت پیشگام تسهیل ورود توسعه‌دهندگان به دنیای همزمانی بوده است. در گذشته، برنامه‌نویسی همزمان، حوزه‌ای تخصصی و در انحصار کارشناسان بود؛ اما اکنون هر توسعه‌دهنده‌ای می‌تواند (و باید) همزمانی را در پروژه‌های خود بگنجاند.

---

## مقدمه‌ای بر همزمانی

پیش از ورود به بحث، لازم است برخی واژه‌ها و تعاریف کلیدی که در سراسر این کتاب استفاده خواهم کرد را شفاف بیان کنم. این تعاریف، چارچوبی یکدست برای تفاوت‌گذاری میان تکنیک‌های مختلف برنامه‌نویسی را فراهم می‌آورد.

**همزمانی**  
انجام بیش از یک کار در یک زمان.

همزمانی کاربردهای بی‌شماری دارد. برنامه‌های کاربری با بهره‌گیری از همزمانی می‌توانند همزمان با نوشتن داده‌ها در پایگاه داده، به ورودی کاربر پاسخ دهند. برنامه‌های سمت سرور نیز برای پاسخگویی به چندین درخواست، همزمانی را به‌کار می‌گیرند. هرگاه لازم باشد یک برنامه، وظایفی را به طور موازی با یکدیگر انجام دهد، همزمانی ضروری است ـ و تقریباً هر نرم‌افزاری در دنیا می‌تواند از مزایای آن بهره‌مند شود.

اغلب برنامه‌نویسان با شنیدن واژه «همزمانی»، بلافاصله به «چندریسمانی» (Multithreading) فکر می‌کنند. اما بهتر است بین این دو تمایز قائل شویم:

**چندریسمانی (Multithreading)**  
شکلی از همزمانی که در آن از چندین رشته اجرایی (Thread) استفاده می‌شود.

چندریسمانی به معنای واقعی، مبتنی بر اجرای هم‌زمان کد روی چندین Thread است. همان‌طور که در بخش‌های بعدی خواهید دید، چندریسمانی تنها یکی از اشکال همزمانی است و به هیچ عنوان یگانه راهکار نیست. حتی در اغلب برنامه‌های مدرن، استفاده مستقیم از نوع‌های سطح پایین ترد ضرورتی ندارد؛ انتزاع‌های سطح بالاتر، قدرتمندتر و کارآمدتر هستند. به همین خاطر در این کتاب، به حداقلِ پوشش مباحث منسوخ بسنده شده ‌است. هیچ‌کدام از نمونه‌های چندریسمانی این کتاب، مستقیماً از Thread یا BackgroundWorker بهره نمی‌برند، چراکه جایگزین‌های بهتر و مدرن وجود دارد.

> **هشدار:**  
> به محض آن‌که بنویسید `new Thread()` پروژه شما عملاً به یک کد میراثی (Legacy Code) تبدیل می‌شود!

البته این بدان معنی نیست که چندریسمانی مُرده است؛ Thread Pool همچنان به‌عنوان بستری پویا و بهینه برای صف‌بندی کارها و تخصیص منابع ایفای نقش می‌کند. Thread Pool همچنین لازمه گونه‌ای مهم از همزمانی است: «پردازش موازی».

**پردازش موازی (Parallel Processing)**  
تقسیم کارهای بزرگ به بخش‌های کوچکتر و اجرای همزمان آن‌ها روی چند ترد مستقل.

پردازش موازی (یا برنامه‌نویسی موازی) با بهره‌گیری از چندریسمانی، به برنامه‌ها اجازه می‌دهد به بهترین شکل از هسته‌های متعدد پردازنده بهره‌مند شوند. امروزه پردازنده‌ها چندین هسته دارند؛ اگر کار بزرگی دارید، عقلانی نیست که فقط یک هسته مشغول باشد و بقیه بدون استفاده بمانند. پردازش موازی، وظایف را بین تردها تقسیم می‌کند تا هر کدام روی هسته جداگانه اجرا شوند.

پردازش موازی، خود زیرمجموعه‌ای از چندریسمانی است و چندریسمانی نیز یکی از اشکال همزمانی است. اما یک گونه مهم دیگر از همزمانی، که معمولاً کمتر شناخته شده، برنامه‌نویسی ناهمگام است.

**برنامه‌نویسی ناهمگام (Asynchronous Programming)**  
شکلی از همزمانی که با استفاده از future یا callbackها، بدون نیاز به ترد اضافی عمل می‌کند.

future (یا promise) نوعی سازه است که نشان‌دهنده عملیاتی است که در آینده تکمیل خواهد شد. در #C و چارچوب .NET، این نوع با `Task` و `Task<TResult>` پیاده‌سازی می‌شود. APIهای ناهمگام قدیمی‌تر به‌جای futureها از callback یا event استفاده می‌کنند. اصل برنامه‌نویسی ناهمگام این است: کاری را آغاز می‌کنید که بعداً به پایان می‌رسد؛ در طول زمان اجرا، ترد اصلی می‌تواند آزادانه کارهای دیگری انجام دهد، و وقتی عملیات تکمیل شد، future یا callback/event به برنامه پایان را اطلاع می‌دهد.

تا پیش از فراگیر شدن عبارت‌های async و await، کدنویسی ناهمگام بسیار پیچیده بود. امروزه اما، این سبک برنامه‌نویسی تقریباً به سادگی اجرای ترتیبیِ عادی است.

در نهایت، نوعی دیگر از همزمانی وجود دارد که آموزش آن برای برنامه‌های مدرن حیاتی است:

**برنامه‌نویسی واکنشی (Reactive Programming)**  
همزمانی بر مبنای رویداد (Event)، جایی که رخدادها ممکن است چندین بار، در هر زمانی و بدون شروع مشخص رخ دهند.

برنامه‌نویسی ناهمگام غالباً به عملیاتی محدود می‌شود که یک‌بار شروع و یک‌بار پایان می‌یابند. اما برنامه‌نویسی واکنشی پیرامون رخدادهای ناهمگام بنا شده است؛ رخدادهایی که ممکن است در هر زمانی و دفعات متعدد به وقوع بپیوندند ـ مثالی ملموس برای آن ورود متناوب کاربر است.

---

</div>
